<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:HasteNotes.ViewModels"
        xmlns:conv="clr-namespace:HasteNotes.Converters"
        xmlns:markdown="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
        x:Class="HasteNotes.Views.AddNoteWindow"
		x:DataType="vm:AddNoteViewModel"
        Width="800"
        SizeToContent="Height"
        Title="Add Note">

    <Window.Resources>
        <conv:GreaterThanZeroToBoolConverter x:Key="GreaterThanZeroToBoolConverter"/>
    </Window.Resources>

	<StackPanel Margin="12" Spacing="8">
        
        <!-- Note Title -->
        <TextBlock Text="Note Title:"/>
        <TextBox Text="{Binding Title, Mode=TwoWay}" />

        <!-- Content -->
        <!-- Content label -->
        <TextBlock Text="Content:" Margin="0,0,0,0"/>

        <Grid Height="500" Margin="0,0,0,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Markdown editor -->
            <TextBox Grid.Row="0"
                        Text="{Binding Content, Mode=TwoWay}"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        Height="250"
                        Margin="0,0,0,8"/>

            <!-- Preview label -->
            <TextBlock Grid.Row="1" Text="Preview:" Margin="0,0,0,2"/>

            <!-- Markdown preview -->
            <Border Grid.Row="2" 
                    BorderBrush="#CCC" 
                    BorderThickness="1" 
                    CornerRadius="4"
                    Padding="6">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                HorizontalScrollBarVisibility="Auto">
                    <markdown:MarkdownScrollViewer Markdown="{Binding Content, Mode=OneWay}"/>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Boss note checkbox -->
        <CheckBox Content="Boss note"
                  IsChecked="{Binding IsBossNote, Mode=TwoWay}"
                                      IsVisible="{Binding Bosses.Count, Converter={StaticResource GreaterThanZeroToBoolConverter}}"/>

        <!-- Grid for Boss dropdown + Steals + Dropped -->
        <Grid Margin="0,8,0,0" Height="170"
                    IsVisible="{Binding Bosses.Count, Converter={StaticResource GreaterThanZeroToBoolConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- Boss selection dropdown -->
            <StackPanel Grid.Column="0" Spacing="4">
                <TextBlock Text="Select Boss:" FontWeight="Bold"/>
                <ComboBox ItemsSource="{Binding Bosses}"
                          SelectedItem="{Binding SelectedBoss, Mode=TwoWay}"
                          IsEnabled="{Binding IsBossNote}"
                          PlaceholderText="Select boss">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding BossName}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>

            <!-- Steals -->
            <StackPanel Grid.Column="1" Spacing="4">
                <TextBlock Text="Steals" FontWeight="Bold"/>
                <ItemsControl ItemsSource="{Binding CurrentSteals}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <CheckBox IsChecked="{Binding IsVisible, Mode=TwoWay}"/>
                                <TextBlock Text="{Binding Display}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- Dropped -->
            <StackPanel Grid.Column="2" Spacing="4">
                <TextBlock Text="Items" FontWeight="Bold"/>
                <ItemsControl ItemsSource="{Binding CurrentDropped}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <CheckBox IsChecked="{Binding IsVisible, Mode=TwoWay}"/>
                                <TextBlock Text="{Binding Display}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

        </Grid>

        <!-- Buttons -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
            <Button Content="Save" Command="{Binding SaveCommand}" />
            <Button Content="Cancel" Command="{Binding CancelCommand}" />
        </StackPanel>

    </StackPanel>
</Window>
