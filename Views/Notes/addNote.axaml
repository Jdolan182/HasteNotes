<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:HasteNotes.ViewModels"
        xmlns:conv="clr-namespace:HasteNotes.Converters"
        xmlns:markdown="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
        x:Class="HasteNotes.Views.AddNoteWindow"
        x:DataType="vm:AddNoteViewModel"
        Width="800"
        Height="900"
        Title="Add Note">

    <Window.Resources>
        <conv:GreaterThanZeroToBoolConverter x:Key="GreaterThanZeroToBoolConverter"/>
    </Window.Resources>

    <!-- MAIN LAYOUT GRID -->
    <Grid Margin="12" RowDefinitions="Auto, *, Auto">

        <!--      ROW 0 - TOP AREA      -->
        <StackPanel Grid.Row="0" Spacing="8">
            <TextBlock Text="Note Title:"/>
            <TextBox Text="{Binding Title, Mode=TwoWay}" />

            <TextBlock Text="Content:"/>
        </StackPanel>

        <!--  ROW 1 - EDITOR + PREVIEW  -->
        <Grid Grid.Row="1"
              Margin="0,0,0,8"
              RowDefinitions="*,Auto,*">
    
            <!-- Editor (expands equally) -->
            <Border Grid.Row="0" BorderThickness="1" BorderBrush="#CCC" CornerRadius="4">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBox Text="{Binding Content, Mode=TwoWay}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             MinHeight="350"
                             FontSize="13"
                             Padding="8"/>
                </ScrollViewer>
            </Border>

            <!-- Preview label -->
            <TextBlock Grid.Row="1"
                       Text="Preview:"
                       Margin="0,6,0,6"/>

            <!-- Preview (expands equally) -->
            <Border Grid.Row="2"
                    BorderBrush="#CCC"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="6">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <markdown:MarkdownScrollViewer 
                        Markdown="{Binding Content}"
                        />
                </ScrollViewer>
            </Border>

        </Grid>

        <!--   ROW 2 - BOSS + BUTTONS   -->
        <StackPanel Grid.Row="2" Spacing="8">

            <!-- Boss note checkbox -->
            <CheckBox Content="Boss note"
                      IsChecked="{Binding IsBossNote}"
                      IsVisible="{Binding Bosses.Count, Converter={StaticResource GreaterThanZeroToBoolConverter}}"/>

            <!-- Boss section (fixed height) -->
            <Grid Height="170"
                  Margin="0,8,0,0"
                  IsVisible="{Binding Bosses.Count, Converter={StaticResource GreaterThanZeroToBoolConverter}}"
                  ColumnDefinitions="2*,3*,3*">

                <!-- Boss selection -->
                <StackPanel Grid.Column="0" Spacing="4">
                    <TextBlock Text="Select Boss:" FontWeight="Bold"/>
                    <ComboBox ItemsSource="{Binding Bosses}"
                              SelectedItem="{Binding SelectedBoss}"
                              IsEnabled="{Binding IsBossNote}"
                              PlaceholderText="Select boss">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding BossName}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <!-- Steals -->
                <StackPanel Grid.Column="1" Spacing="4">
                    <TextBlock Text="Steals" FontWeight="Bold"/>
                    <ItemsControl ItemsSource="{Binding EditingSteals}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <CheckBox IsChecked="{Binding IsVisible}"/>
                                    <TextBlock Text="{Binding Display}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Dropped -->
                <StackPanel Grid.Column="2" Spacing="4">
                    <TextBlock Text="Items" FontWeight="Bold"/>
                    <ItemsControl ItemsSource="{Binding EditingItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <CheckBox IsChecked="{Binding IsVisible}"/>
                                    <TextBlock Text="{Binding Display}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

            </Grid>

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Spacing="8">
                <Button Content="Save" Command="{Binding SaveCommand}" />
                <Button Content="Cancel" Command="{Binding CancelCommand}" />
            </StackPanel>

        </StackPanel>

    </Grid>
</Window>